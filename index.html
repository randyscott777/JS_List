<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .priority-1 { border-left: 4px solid #28a745; }
        .priority-2 { border-left: 4px solid #ffc107; }
        .priority-3 { border-left: 4px solid #fd7e14; }
        .priority-4 { border-left: 4px solid #dc3545; }
        .priority-5 { border-left: 4px solid #6f42c1; }
        .completed { opacity: 0.6; }
        .completed .card-title { text-decoration: line-through; }
        .list-item { transition: all 0.3s ease; cursor: pointer; }
        .list-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .modal-backdrop { z-index: 1040; }
        .modal { z-index: 1050; }
        .stats-card { background: linear-gradient(45deg, #007bff, #0056b3); color: white; }
        .category-badge { cursor: pointer; }
        .priority-badge {
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }
        .search-container { position: relative; }
        .search-container .search-icon { 
            position: absolute; 
            left: 10px; 
            top: 50%; 
            transform: translateY(-50%); 
            color: #6c757d; 
        }
        .search-container input { padding-left: 35px; }
        .export-section { background: #f8f9fa; border-radius: 10px; }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showSection('main')">
                <i class="fas fa-list"></i> List Manager
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="#" onclick="showSection('main')">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <a class="nav-link" href="#" onclick="showAddModal()">
                        <i class="fas fa-plus"></i> Add Item
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('stats')">
                        <i class="fas fa-chart-bar"></i> Statistics
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('export')">
                        <i class="fas fa-download"></i> Export/Import
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Alert Container -->
    <div id="alertContainer" class="container mt-3"></div>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Main List Section -->
        <div id="mainSection">
            <div class="row">
                <div class="col-md-8">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>My List <span id="itemCount" class="badge bg-primary">0</span></h2>
                        <button class="btn btn-primary" onclick="showAddModal()">
                            <i class="fas fa-plus"></i> Add Item
                        </button>
                    </div>
                    
                    <!-- Search and Filters -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="search-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="searchInput" class="form-control" placeholder="Search items..." oninput="filterItems()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select id="categoryFilter" class="form-select" onchange="filterItems()">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="priorityFilter" class="form-select" onchange="filterItems()">
                                <option value="">All Priorities</option>
                                <option value="5">Priority 5 (Critical)</option>
                                <option value="4">Priority 4 (Urgent)</option>
                                <option value="3">Priority 3 (High)</option>
                                <option value="2">Priority 2 (Medium)</option>
                                <option value="1">Priority 1 (Low)</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="showCompleted" onchange="filterItems()">
                                <label class="form-check-label" for="showCompleted">
                                    Show Completed
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Sort Options -->
                    <div class="mb-3">
                        <small class="text-muted">Sort by:</small>
                        <div class="btn-group btn-group-sm ms-2" role="group">
                            <input type="radio" class="btn-check" name="sortBy" id="sortDate" value="date" checked onchange="filterItems()">
                            <label class="btn btn-outline-secondary" for="sortDate">Date</label>
                            
                            <input type="radio" class="btn-check" name="sortBy" id="sortPriority" value="priority" onchange="filterItems()">
                            <label class="btn btn-outline-secondary" for="sortPriority">Priority</label>
                            
                            <input type="radio" class="btn-check" name="sortBy" id="sortTitle" value="title" onchange="filterItems()">
                            <label class="btn btn-outline-secondary" for="sortTitle">Title</label>
                        </div>
                    </div>

                    <!-- Items List -->
                    <div id="itemsList"></div>
                </div>
                
                <!-- Sidebar -->
                <div class="col-md-4">
                    <div class="card stats-card mb-3">
                        <div class="card-header">
                            <h5><i class="fas fa-info-circle"></i> Quick Stats</h5>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-4">
                                    <h4 id="totalItems">0</h4>
                                    <small>Total</small>
                                </div>
                                <div class="col-4">
                                    <h4 id="completedItems">0</h4>
                                    <small>Completed</small>
                                </div>
                                <div class="col-4">
                                    <h4 id="pendingItems">0</h4>
                                    <small>Pending</small>
                                </div>
                            </div>
                            <div class="progress mt-2">
                                <div id="progressBar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="fas fa-clock"></i> Recent Activity</h6>
                        </div>
                        <div class="card-body">
                            <div id="recentActivity">
                                <small class="text-muted">No recent activity</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Section -->
        <div id="statsSection" style="display: none;">
            <h2>Statistics</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <h5><i class="fas fa-chart-pie"></i> Overview</h5>
                        </div>
                        <div class="card-body" id="overviewStats"></div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <h5><i class="fas fa-tags"></i> By Category</h5>
                        </div>
                        <div class="card-body" id="categoryStats"></div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-header bg-info text-white">
                            <h5><i class="fas fa-exclamation-triangle"></i> By Priority</h5>
                        </div>
                        <div class="card-body" id="priorityStats"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export/Import Section -->
        <div id="exportSection" style="display: none;">
            <h2>Export & Import Data</h2>
            <div class="row">
                <div class="col-md-6">
                    <div class="card export-section p-4 mb-3">
                        <h5><i class="fas fa-download"></i> Export Data</h5>
                        <p class="text-muted">Download your list data as JSON for backup or sharing.</p>
                        <button class="btn btn-primary" onclick="exportData()">
                            <i class="fas fa-download"></i> Export JSON
                        </button>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card export-section p-4 mb-3">
                        <h5><i class="fas fa-upload"></i> Import Data</h5>
                        <p class="text-muted">Upload a JSON file to restore your list data.</p>
                        <input type="file" id="importFile" class="form-control mb-2" accept=".json">
                        <button class="btn btn-success" onclick="importData()">
                            <i class="fas fa-upload"></i> Import JSON
                        </button>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card export-section p-4">
                        <h5><i class="fas fa-trash-alt text-danger"></i> Clear All Data</h5>
                        <p class="text-muted">Permanently delete all items from your list. This cannot be undone.</p>
                        <button class="btn btn-danger" onclick="clearAllData()">
                            <i class="fas fa-trash-alt"></i> Clear All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div class="modal fade" id="itemModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add New Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="itemForm">
                        <input type="hidden" id="itemId">
                        <div class="mb-3">
                            <label for="itemTitle" class="form-label">Title *</label>
                            <input type="text" class="form-control" id="itemTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="itemDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="itemDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="itemCategory" class="form-label">Category</label>
                            <input type="text" class="form-control" id="itemCategory" value="General" list="categoryList">
                            <datalist id="categoryList"></datalist>
                        </div>
                        <div class="mb-3">
                            <label for="itemPriority" class="form-label">Priority</label>
                            <select class="form-select" id="itemPriority">
                                <option value="1">1 - Low</option>
                                <option value="2">2 - Medium</option>
                                <option value="3" selected>3 - High</option>
                                <option value="4">4 - Urgent</option>
                                <option value="5">5 - Critical</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveItem()">Save Item</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Debug: Check if Bootstrap loaded
        if (typeof bootstrap === 'undefined') {
            console.error('Bootstrap JavaScript not loaded');
            window.bootstrap = {
                Modal: function(element) {
                    return {
                        show: function() {
                            element.style.display = 'block';
                            element.classList.add('show');
                            document.body.classList.add('modal-open');
                            
                            // Create backdrop
                            const backdrop = document.createElement('div');
                            backdrop.className = 'modal-backdrop fade show';
                            backdrop.id = 'modal-backdrop-fallback';
                            document.body.appendChild(backdrop);
                        },
                        hide: function() {
                            element.style.display = 'none';
                            element.classList.remove('show');
                            document.body.classList.remove('modal-open');
                            
                            // Remove backdrop
                            const backdrop = document.getElementById('modal-backdrop-fallback');
                            if (backdrop) backdrop.remove();
                        }
                    };
                }
            };
        } else {
            console.log('Bootstrap loaded successfully');
        }

        // Global variables
        let items = JSON.parse(localStorage.getItem('listItems') || '[]');
        let currentEditId = null;
        let itemModal;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App initializing...');
            
            // Initialize modal
            const modalElement = document.getElementById('itemModal');
            if (modalElement) {
                itemModal = new bootstrap.Modal(modalElement);
                console.log('Modal initialized');
            } else {
                console.error('Modal element not found');
            }
            
            // Load initial data
            loadItems();
            updateStats();
            updateFilters();
            filterItems();
            
            console.log('App initialized with', items.length, 'items');
        });

        // Show alert message
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alert);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 3000);
        }

        // Section navigation
        function showSection(section) {
            document.getElementById('mainSection').style.display = section === 'main' ? 'block' : 'none';
            document.getElementById('statsSection').style.display = section === 'stats' ? 'block' : 'none';
            document.getElementById('exportSection').style.display = section === 'export' ? 'block' : 'none';
            
            if (section === 'stats') {
                updateStatsSection();
            }
        }

        // Generate unique ID
        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        // Save to localStorage
        function saveToStorage() {
            localStorage.setItem('listItems', JSON.stringify(items));
        }

        // Show add modal
        function showAddModal() {
            console.log('showAddModal called');
            
            // Initialize modal if not already done
            if (!itemModal) {
                const modalElement = document.getElementById('itemModal');
                if (modalElement) {
                    itemModal = new bootstrap.Modal(modalElement);
                    console.log('Modal initialized in showAddModal');
                } else {
                    console.error('Modal element not found in showAddModal');
                    return;
                }
            }
            
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Add New Item';
            document.getElementById('itemForm').reset();
            document.getElementById('itemCategory').value = 'General';
            document.getElementById('itemPriority').value = '3';
            updateCategoryDatalist();
            
            try {
                itemModal.show();
                console.log('Modal shown');
            } catch (error) {
                console.error('Error showing modal:', error);
                // Fallback: show modal manually
                const modalEl = document.getElementById('itemModal');
                modalEl.style.display = 'block';
                modalEl.classList.add('show');
                document.body.classList.add('modal-open');
                
                // Create backdrop
                const backdrop = document.createElement('div');
                backdrop.className = 'modal-backdrop fade show';
                backdrop.id = 'modal-backdrop-fallback';
                document.body.appendChild(backdrop);
            }
        }

        // Show edit modal
        function showEditModal(id) {
            const item = items.find(i => i.id === id);
            if (!item) return;

            currentEditId = id;
            document.getElementById('modalTitle').textContent = 'Edit Item';
            document.getElementById('itemTitle').value = item.title;
            document.getElementById('itemDescription').value = item.description || '';
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemPriority').value = item.priority.toString();
            updateCategoryDatalist();
            itemModal.show();
        }

        // Update category datalist
        function updateCategoryDatalist() {
            const categories = [...new Set(items.map(item => item.category))];
            const datalist = document.getElementById('categoryList');
            datalist.innerHTML = categories.map(cat => `<option value="${cat}">`).join('');
        }

        // Save item
        function saveItem() {
            console.log('saveItem called');
            
            const title = document.getElementById('itemTitle').value.trim();
            const description = document.getElementById('itemDescription').value.trim();
            const category = document.getElementById('itemCategory').value.trim() || 'General';
            const priority = parseInt(document.getElementById('itemPriority').value);

            console.log('Form data:', { title, description, category, priority });

            if (!title) {
                showAlert('Title is required!', 'danger');
                return;
            }

            const now = new Date().toISOString();

            if (currentEditId) {
                // Edit existing item
                const item = items.find(i => i.id === currentEditId);
                if (item) {
                    item.title = title;
                    item.description = description;
                    item.category = category;
                    item.priority = priority;
                    item.updatedAt = now;
                    showAlert('Item updated successfully!');
                    console.log('Item updated:', item);
                }
            } else {
                // Add new item
                const newItem = {
                    id: generateId(),
                    title,
                    description,
                    category,
                    priority,
                    completed: false,
                    createdAt: now,
                    updatedAt: now
                };
                items.push(newItem);
                showAlert('Item added successfully!');
                console.log('New item added:', newItem);
            }

            saveToStorage();
            hideModal();
            loadItems();
            updateStats();
            updateFilters();
            filterItems();
        }

        // Hide modal function
        function hideModal() {
            try {
                if (itemModal && itemModal.hide) {
                    itemModal.hide();
                } else {
                    // Fallback manual hide
                    const modalEl = document.getElementById('itemModal');
                    modalEl.style.display = 'none';
                    modalEl.classList.remove('show');
                    document.body.classList.remove('modal-open');
                    
                    // Remove backdrop
                    const backdrop = document.getElementById('modal-backdrop-fallback');
                    if (backdrop) backdrop.remove();
                }
                console.log('Modal hidden');
            } catch (error) {
                console.error('Error hiding modal:', error);
            }
        }

        // Toggle item completion
        function toggleItem(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                item.updatedAt = new Date().toISOString();
                saveToStorage();
                loadItems();
                updateStats();
                filterItems();
                showAlert(`Item ${item.completed ? 'completed' : 'reopened'}!`);
            }
        }

        // Delete item
        function deleteItem(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                items = items.filter(i => i.id !== id);
                saveToStorage();
                loadItems();
                updateStats();
                updateFilters();
                filterItems();
                showAlert('Item deleted successfully!');
            }
        }

        // Get priority label
        function getPriorityLabel(priority) {
            const labels = {
                1: 'Low',
                2: 'Medium', 
                3: 'High',
                4: 'Urgent',
                5: 'Critical'
            };
            return labels[priority] || 'Medium';
        }

        // Get priority color
        function getPriorityColor(priority) {
            const colors = {
                1: 'success',
                2: 'warning',
                3: 'primary', 
                4: 'danger',
                5: 'dark'
            };
            return colors[priority] || 'primary';
        }

        // Format date
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString() + ' ' + 
                   new Date(dateString).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        // Load and display items
        function loadItems() {
            // This will be called by filterItems()
        }

        // Filter and display items
        function filterItems() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const showCompleted = document.getElementById('showCompleted').checked;
            const sortBy = document.querySelector('input[name="sortBy"]:checked').value;

            let filteredItems = items.filter(item => {
                const matchesSearch = item.title.toLowerCase().includes(searchTerm) || 
                                    (item.description && item.description.toLowerCase().includes(searchTerm));
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                const matchesPriority = !priorityFilter || item.priority.toString() === priorityFilter;
                const matchesCompleted = showCompleted || !item.completed;

                return matchesSearch && matchesCategory && matchesPriority && matchesCompleted;
            });

            // Sort items
            filteredItems.sort((a, b) => {
                switch (sortBy) {
                    case 'priority':
                        if (a.priority !== b.priority) return b.priority - a.priority;
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'date':
                    default:
                        return new Date(b.createdAt) - new Date(a.createdAt);
                }
            });

            displayItems(filteredItems);
            document.getElementById('itemCount').textContent = filteredItems.length;
        }

        // Display items
        function displayItems(itemsToShow) {
            const container = document.getElementById('itemsList');
            
            if (itemsToShow.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-list-alt fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">No items found</h4>
                        <p class="text-muted">Start by adding your first item to the list!</p>
                        <button class="btn btn-primary" onclick="showAddModal()">
                            <i class="fas fa-plus"></i> Add First Item
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = itemsToShow.map(item => `
                <div class="card mb-3 list-item priority-${item.priority} ${item.completed ? 'completed' : ''}" 
                     onclick="event.target.tagName === 'DIV' && toggleItem('${item.id}')">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h5 class="card-title mb-1">
                                    <i class="fas ${item.completed ? 'fa-check-circle text-success' : 'fa-circle text-muted'}"></i>
                                    ${item.title}
                                </h5>
                                ${item.description ? `<p class="card-text text-muted">${item.description}</p>` : ''}
                                <div class="small text-muted">
                                    <span class="badge bg-secondary category-badge" onclick="event.stopPropagation(); filterByCategory('${item.category}')">${item.category}</span>
                                    <span class="badge bg-${getPriorityColor(item.priority)} priority-badge">Priority ${item.priority} (${getPriorityLabel(item.priority)})</span>
                                    <span>Created: ${formatDate(item.createdAt)}</span>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm ${item.completed ? 'btn-warning' : 'btn-success'}" 
                                            onclick="event.stopPropagation(); toggleItem('${item.id}')"
                                            title="${item.completed ? 'Mark as Pending' : 'Mark as Complete'}">
                                        <i class="fas ${item.completed ? 'fa-undo' : 'fa-check'}"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" 
                                            onclick="event.stopPropagation(); showEditModal('${item.id}')" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" 
                                            onclick="event.stopPropagation(); deleteItem('${item.id}')" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filter by category (when clicking category badge)
        function filterByCategory(category) {
            document.getElementById('categoryFilter').value = category;
            filterItems();
        }

        // Update filter dropdowns
        function updateFilters() {
            const categories = [...new Set(items.map(item => item.category))].sort();
            const categoryFilter = document.getElementById('categoryFilter');
            const currentValue = categoryFilter.value;
            
            categoryFilter.innerHTML = '<option value="">All Categories</option>' + 
                categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
            
            categoryFilter.value = currentValue;
        }

        // Update statistics
        function updateStats() {
            const total = items.length;
            const completed = items.filter(item => item.completed).length;
            const pending = total - completed;
            const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('totalItems').textContent = total;
            document.getElementById('completedItems').textContent = completed;
            document.getElementById('pendingItems').textContent = pending;
            document.getElementById('progressBar').style.width = completionRate + '%';
            document.getElementById('progressBar').textContent = completionRate + '%';

            updateRecentActivity();
        }

        // Update recent activity
        function updateRecentActivity() {
            const recent = items
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                .slice(0, 5);

            const container = document.getElementById('recentActivity');
            
            if (recent.length === 0) {
                container.innerHTML = '<small class="text-muted">No recent activity</small>';
                return;
            }

            container.innerHTML = recent.map(item => `
                <div class="small mb-1">
                    <i class="fas ${item.completed ? 'fa-check-circle text-success' : 'fa-circle text-muted'}"></i>
                    <strong>${item.title}</strong>
                    <br>
                    <span class="text-muted">${formatDate(item.updatedAt)}</span>
                </div>
            `).join('');
        }

        // Update statistics section
        function updateStatsSection() {
            const total = items.length;
            const completed = items.filter(item => item.completed).length;
            const pending = total - completed;
            const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

            // Overview stats
            document.getElementById('overviewStats').innerHTML = `
                <div class="mb-2"><strong>Total Items:</strong> ${total}</div>
                <div class="mb-2"><strong>Completed:</strong> <span class="text-success">${completed}</span> (${completionRate}%)</div>
                <div class="mb-2"><strong>Pending:</strong> <span class="text-warning">${pending}</span> (${100 - completionRate}%)</div>
                <div class="progress">
                    <div class="progress-bar bg-success" style="width: ${completionRate}%"></div>
                </div>
            `;

            // Category stats
            const categoryStats = {};
            items.forEach(item => {
                if (!categoryStats[item.category]) {
                    categoryStats[item.category] = { total: 0, completed: 0 };
                }
                categoryStats[item.category].total++;
                if (item.completed) categoryStats[item.category].completed++;
            });

            document.getElementById('categoryStats').innerHTML = Object.entries(categoryStats)
                .sort(([,a], [,b]) => b.total - a.total)
                .map(([category, stats]) => `
                    <div class="mb-2">
                        <strong>${category}:</strong> ${stats.total}
                        <small class="text-muted">(${stats.completed} completed)</small>
                    </div>
                `).join('') || '<div class="text-muted">No categories</div>';

            // Priority stats
            const priorityStats = {};
            items.forEach(item => {
                if (!priorityStats[item.priority]) {
                    priorityStats[item.priority] = { total: 0, completed: 0 };
                }
                priorityStats[item.priority].total++;
                if (item.completed) priorityStats[item.priority].completed++;
            });

            document.getElementById('priorityStats').innerHTML = Object.entries(priorityStats)
                .sort(([a], [b]) => b - a)
                .map(([priority, stats]) => `
                    <div class="mb-2">
                        <strong>Priority ${priority} (${getPriorityLabel(parseInt(priority))}):</strong> ${stats.total}
                        <small class="text-muted">(${stats.completed} completed)</small>
                    </div>
                `).join('') || '<div class="text-muted">No priorities</div>';
        }

        // Export data
        function exportData() {
            const data = {
                items: items,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `list-manager-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showAlert('Data exported successfully!');
        }

        // Import data
        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('Please select a file to import.', 'warning');
                return;
            }

            if (!file.name.endsWith('.json')) {
                showAlert('Please select a valid JSON file.', 'danger');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.items || !Array.isArray(data.items)) {
                        throw new Error('Invalid file format');
                    }

                    // Validate and import items
                    const importedItems = data.items.filter(item => 
                        item.id && item.title && typeof item.completed === 'boolean'
                    );

                    if (importedItems.length === 0) {
                        showAlert('No valid items found in the file.', 'warning');
                        return;
                    }

                    // Merge with existing items (avoid duplicates by ID)
                    const existingIds = new Set(items.map(item => item.id));
                    const newItems = importedItems.filter(item => !existingIds.has(item.id));
                    
                    items = [...items, ...newItems];
                    saveToStorage();
                    loadItems();
                    updateStats();
                    updateFilters();
                    filterItems();
                    
                    showAlert(`Successfully imported ${newItems.length} new items!`);
                    fileInput.value = '';
                    
                } catch (error) {
                    showAlert('Error importing file. Please check the file format.', 'danger');
                    console.error('Import error:', error);
                }
            };
            
            reader.readAsText(file);
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL items? This cannot be undone!')) {
                if (confirm('This will permanently delete all your list items. Are you absolutely sure?')) {
                    items = [];
                    saveToStorage();
                    loadItems();
                    updateStats();
                    updateFilters();
                    filterItems();
                    showAlert('All data has been cleared.', 'warning');
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + N for new item
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                showAddModal();
            }
            
            // Escape to close modal
            if (e.key === 'Escape' && itemModal._isShown) {
                itemModal.hide();
            }
            
            // Enter to save item when modal is open
            if (e.key === 'Enter' && itemModal._isShown && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                saveItem();
            }
        });

        // Auto-save draft as user types
        let draftTimeout;
        function saveDraft() {
            clearTimeout(draftTimeout);
            draftTimeout = setTimeout(() => {
                if (itemModal._isShown) {
                    const draft = {
                        title: document.getElementById('itemTitle').value,
                        description: document.getElementById('itemDescription').value,
                        category: document.getElementById('itemCategory').value,
                        priority: document.getElementById('itemPriority').value
                    };
                    localStorage.setItem('itemDraft', JSON.stringify(draft));
                }
            }, 1000);
        }

        // Load draft when opening modal
        function loadDraft() {
            const draft = localStorage.getItem('itemDraft');
            if (draft && !currentEditId) {
                const draftData = JSON.parse(draft);
                if (draftData.title) {
                    document.getElementById('itemTitle').value = draftData.title;
                    document.getElementById('itemDescription').value = draftData.description || '';
                    document.getElementById('itemCategory').value = draftData.category || 'General';
                    document.getElementById('itemPriority').value = draftData.priority || '3';
                }
            }
        }

        // Clear draft when saving or canceling
        function clearDraft() {
            localStorage.removeItem('itemDraft');
        }

        // Add event listeners for draft saving
        document.getElementById('itemTitle').addEventListener('input', saveDraft);
        document.getElementById('itemDescription').addEventListener('input', saveDraft);
        document.getElementById('itemCategory').addEventListener('input', saveDraft);
        document.getElementById('itemPriority').addEventListener('change', saveDraft);

        // Enhanced modal events
        document.getElementById('itemModal').addEventListener('shown.bs.modal', loadDraft);
        document.getElementById('itemModal').addEventListener('hidden.bs.modal', clearDraft);

        // Sample data for first-time users
        function addSampleData() {
            if (items.length === 0) {
                const sampleItems = [
                    {
                        id: generateId(),
                        title: "Welcome to List Manager!",
                        description: "This is a sample item to get you started. You can edit or delete it.",
                        category: "Getting Started",
                        priority: 3,
                        completed: false,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: generateId(),
                        title: "Try adding your own item",
                        description: "Click the 'Add Item' button to create your first real task.",
                        category: "Getting Started",
                        priority: 2,
                        completed: false,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: generateId(),
                        title: "Explore the features",
                        description: "Check out the statistics page and try filtering by category or priority.",
                        category: "Tutorial",
                        priority: 1,
                        completed: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];
                
                items = sampleItems;
                saveToStorage();
            }
        }

        // Initialize with sample data if needed
        if (items.length === 0 && !localStorage.getItem('hasVisited')) {
            addSampleData();
            localStorage.setItem('hasVisited', 'true');
            showAlert('Welcome! We\'ve added some sample items to get you started.', 'info');
        }

        // Performance optimization: Debounce search
        let searchTimeout;
        document.getElementById('searchInput').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(filterItems, 300);
        });

        // Add tooltips for better UX
        function initTooltips() {
            const tooltips = document.querySelectorAll('[title]');
            tooltips.forEach(element => {
                new bootstrap.Tooltip(element);
            });
        }

        // Initialize tooltips after items are loaded
        setTimeout(initTooltips, 1000);

        // Service Worker for offline functionality (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful');
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
